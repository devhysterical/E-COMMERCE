{"version":3,"sources":["../../src/loyalty/loyalty.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Patch,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  UseGuards,\r\n  Request,\r\n} from '@nestjs/common';\r\nimport { LoyaltyService } from './loyalty.service';\r\nimport { RedeemPointsDto } from './dto/redeem-points.dto';\r\nimport { AdjustPointsDto } from './dto/adjust-points.dto';\r\nimport { CreateTierDto } from './dto/create-tier.dto';\r\nimport { UpdateTierDto } from './dto/update-tier.dto';\r\nimport { CreateRewardDto } from './dto/create-reward.dto';\r\nimport { UpdateRewardDto } from './dto/update-reward.dto';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\n\r\n@Controller('loyalty')\r\n@UseGuards(JwtAuthGuard)\r\nexport class LoyaltyController {\r\n  constructor(private readonly loyaltyService: LoyaltyService) {}\r\n\r\n  // --- User endpoints ---\r\n\r\n  @Get('balance')\r\n  getBalance(@Request() req: { user: { sub: string } }) {\r\n    return this.loyaltyService.getBalance(req.user.sub);\r\n  }\r\n\r\n  @Get('history')\r\n  getHistory(@Request() req: { user: { sub: string } }) {\r\n    return this.loyaltyService.getHistory(req.user.sub);\r\n  }\r\n\r\n  @Get('rewards')\r\n  getActiveRewards() {\r\n    return this.loyaltyService.getActiveRewards();\r\n  }\r\n\r\n  @Get('tiers')\r\n  getTiers() {\r\n    return this.loyaltyService.getAllTiers();\r\n  }\r\n\r\n  @Post('redeem')\r\n  redeem(\r\n    @Request() req: { user: { sub: string } },\r\n    @Body() dto: RedeemPointsDto,\r\n  ) {\r\n    return this.loyaltyService.redeemPoints(req.user.sub, dto.rewardId);\r\n  }\r\n\r\n  // --- Admin endpoints ---\r\n\r\n  @Get('admin/tiers')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminGetTiers() {\r\n    return this.loyaltyService.getAllTiers();\r\n  }\r\n\r\n  @Post('admin/tiers')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminCreateTier(@Body() dto: CreateTierDto) {\r\n    return this.loyaltyService.createTier(dto);\r\n  }\r\n\r\n  @Patch('admin/tiers/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminUpdateTier(@Param('id') id: string, @Body() dto: UpdateTierDto) {\r\n    return this.loyaltyService.updateTier(id, dto);\r\n  }\r\n\r\n  @Delete('admin/tiers/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminDeleteTier(@Param('id') id: string) {\r\n    return this.loyaltyService.deleteTier(id);\r\n  }\r\n\r\n  @Get('admin/rewards')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminGetRewards() {\r\n    return this.loyaltyService.getAllRewards();\r\n  }\r\n\r\n  @Post('admin/rewards')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminCreateReward(@Body() dto: CreateRewardDto) {\r\n    return this.loyaltyService.createReward(dto);\r\n  }\r\n\r\n  @Patch('admin/rewards/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminUpdateReward(@Param('id') id: string, @Body() dto: UpdateRewardDto) {\r\n    return this.loyaltyService.updateReward(id, dto);\r\n  }\r\n\r\n  @Delete('admin/rewards/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminDeleteReward(@Param('id') id: string) {\r\n    return this.loyaltyService.deleteReward(id);\r\n  }\r\n\r\n  @Post('admin/adjust')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminAdjustPoints(@Body() dto: AdjustPointsDto) {\r\n    return this.loyaltyService.adjustPoints(dto);\r\n  }\r\n\r\n  @Get('admin/users')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  adminGetUsersWithPoints() {\r\n    return this.loyaltyService.getUsersWithPoints();\r\n  }\r\n}\r\n"],"names":["LoyaltyController","getBalance","req","loyaltyService","user","sub","getHistory","getActiveRewards","getTiers","getAllTiers","redeem","dto","redeemPoints","rewardId","adminGetTiers","adminCreateTier","createTier","adminUpdateTier","id","updateTier","adminDeleteTier","deleteTier","adminGetRewards","getAllRewards","adminCreateReward","createReward","adminUpdateReward","updateReward","adminDeleteReward","deleteReward","adminAdjustPoints","adjustPoints","adminGetUsersWithPoints","getUsersWithPoints"],"mappings":";;;;+BAwBaA;;;eAAAA;;;wBAdN;gCACwB;iCACC;iCACA;+BACF;+BACA;iCACE;iCACA;8BACH;4BACF;gCACL;;;;;;;;;;;;;;;AAIf,IAAA,AAAMA,oBAAN,MAAMA;IAGX,yBAAyB;IAGzBC,WAAW,AAAWC,GAA8B,EAAE;QACpD,OAAO,IAAI,CAACC,cAAc,CAACF,UAAU,CAACC,IAAIE,IAAI,CAACC,GAAG;IACpD;IAGAC,WAAW,AAAWJ,GAA8B,EAAE;QACpD,OAAO,IAAI,CAACC,cAAc,CAACG,UAAU,CAACJ,IAAIE,IAAI,CAACC,GAAG;IACpD;IAGAE,mBAAmB;QACjB,OAAO,IAAI,CAACJ,cAAc,CAACI,gBAAgB;IAC7C;IAGAC,WAAW;QACT,OAAO,IAAI,CAACL,cAAc,CAACM,WAAW;IACxC;IAGAC,OACE,AAAWR,GAA8B,EACzC,AAAQS,GAAoB,EAC5B;QACA,OAAO,IAAI,CAACR,cAAc,CAACS,YAAY,CAACV,IAAIE,IAAI,CAACC,GAAG,EAAEM,IAAIE,QAAQ;IACpE;IAEA,0BAA0B;IAK1BC,gBAAgB;QACd,OAAO,IAAI,CAACX,cAAc,CAACM,WAAW;IACxC;IAKAM,gBAAgB,AAAQJ,GAAkB,EAAE;QAC1C,OAAO,IAAI,CAACR,cAAc,CAACa,UAAU,CAACL;IACxC;IAKAM,gBAAgB,AAAaC,EAAU,EAAE,AAAQP,GAAkB,EAAE;QACnE,OAAO,IAAI,CAACR,cAAc,CAACgB,UAAU,CAACD,IAAIP;IAC5C;IAKAS,gBAAgB,AAAaF,EAAU,EAAE;QACvC,OAAO,IAAI,CAACf,cAAc,CAACkB,UAAU,CAACH;IACxC;IAKAI,kBAAkB;QAChB,OAAO,IAAI,CAACnB,cAAc,CAACoB,aAAa;IAC1C;IAKAC,kBAAkB,AAAQb,GAAoB,EAAE;QAC9C,OAAO,IAAI,CAACR,cAAc,CAACsB,YAAY,CAACd;IAC1C;IAKAe,kBAAkB,AAAaR,EAAU,EAAE,AAAQP,GAAoB,EAAE;QACvE,OAAO,IAAI,CAACR,cAAc,CAACwB,YAAY,CAACT,IAAIP;IAC9C;IAKAiB,kBAAkB,AAAaV,EAAU,EAAE;QACzC,OAAO,IAAI,CAACf,cAAc,CAAC0B,YAAY,CAACX;IAC1C;IAKAY,kBAAkB,AAAQnB,GAAoB,EAAE;QAC9C,OAAO,IAAI,CAACR,cAAc,CAAC4B,YAAY,CAACpB;IAC1C;IAKAqB,0BAA0B;QACxB,OAAO,IAAI,CAAC7B,cAAc,CAAC8B,kBAAkB;IAC/C;IAtGA,YAAY,AAAiB9B,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AAuGhE"}