{"version":3,"sources":["../../src/carts/carts.service.ts"],"sourcesContent":["import { Injectable, NotFoundException } from '@nestjs/common';\r\nimport { PrismaService } from '../prisma/prisma.service';\r\n\r\n@Injectable()\r\nexport class CartsService {\r\n  constructor(private prisma: PrismaService) {}\r\n\r\n  async getCart(userId: string) {\r\n    let cart = await this.prisma.cart.findUnique({\r\n      where: { userId },\r\n      include: {\r\n        cartItems: {\r\n          include: { product: true },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!cart) {\r\n      cart = await this.prisma.cart.create({\r\n        data: { userId },\r\n        include: {\r\n          cartItems: {\r\n            include: { product: true },\r\n          },\r\n        },\r\n      });\r\n    }\r\n\r\n    return cart;\r\n  }\r\n\r\n  async addToCart(userId: string, productId: string, quantity: number) {\r\n    const cart = await this.getCart(userId);\r\n\r\n    const existingItem = await this.prisma.cartItem.findFirst({\r\n      where: { cartId: cart.id, productId },\r\n    });\r\n\r\n    if (existingItem) {\r\n      return this.prisma.cartItem.update({\r\n        where: { id: existingItem.id },\r\n        data: { quantity: existingItem.quantity + quantity },\r\n      });\r\n    }\r\n\r\n    return this.prisma.cartItem.create({\r\n      data: {\r\n        cartId: cart.id,\r\n        productId,\r\n        quantity,\r\n      },\r\n    });\r\n  }\r\n\r\n  async updateQuantity(itemId: string, quantity: number) {\r\n    if (quantity <= 0) {\r\n      return this.prisma.cartItem.delete({ where: { id: itemId } });\r\n    }\r\n    return this.prisma.cartItem.update({\r\n      where: { id: itemId },\r\n      data: { quantity },\r\n    });\r\n  }\r\n\r\n  async removeItem(itemId: string) {\r\n    return this.prisma.cartItem.delete({ where: { id: itemId } });\r\n  }\r\n\r\n  async clearCart(userId: string) {\r\n    const cart = await this.getCart(userId);\r\n    return this.prisma.cartItem.deleteMany({\r\n      where: { cartId: cart.id },\r\n    });\r\n  }\r\n}\r\n"],"names":["CartsService","getCart","userId","cart","prisma","findUnique","where","include","cartItems","product","create","data","addToCart","productId","quantity","existingItem","cartItem","findFirst","cartId","id","update","updateQuantity","itemId","delete","removeItem","clearCart","deleteMany"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJiC;+BAChB;;;;;;;;;;AAGvB,IAAA,AAAMA,eAAN,MAAMA;IAGX,MAAMC,QAAQC,MAAc,EAAE;QAC5B,IAAIC,OAAO,MAAM,IAAI,CAACC,MAAM,CAACD,IAAI,CAACE,UAAU,CAAC;YAC3CC,OAAO;gBAAEJ;YAAO;YAChBK,SAAS;gBACPC,WAAW;oBACTD,SAAS;wBAAEE,SAAS;oBAAK;gBAC3B;YACF;QACF;QAEA,IAAI,CAACN,MAAM;YACTA,OAAO,MAAM,IAAI,CAACC,MAAM,CAACD,IAAI,CAACO,MAAM,CAAC;gBACnCC,MAAM;oBAAET;gBAAO;gBACfK,SAAS;oBACPC,WAAW;wBACTD,SAAS;4BAAEE,SAAS;wBAAK;oBAC3B;gBACF;YACF;QACF;QAEA,OAAON;IACT;IAEA,MAAMS,UAAUV,MAAc,EAAEW,SAAiB,EAAEC,QAAgB,EAAE;QACnE,MAAMX,OAAO,MAAM,IAAI,CAACF,OAAO,CAACC;QAEhC,MAAMa,eAAe,MAAM,IAAI,CAACX,MAAM,CAACY,QAAQ,CAACC,SAAS,CAAC;YACxDX,OAAO;gBAAEY,QAAQf,KAAKgB,EAAE;gBAAEN;YAAU;QACtC;QAEA,IAAIE,cAAc;YAChB,OAAO,IAAI,CAACX,MAAM,CAACY,QAAQ,CAACI,MAAM,CAAC;gBACjCd,OAAO;oBAAEa,IAAIJ,aAAaI,EAAE;gBAAC;gBAC7BR,MAAM;oBAAEG,UAAUC,aAAaD,QAAQ,GAAGA;gBAAS;YACrD;QACF;QAEA,OAAO,IAAI,CAACV,MAAM,CAACY,QAAQ,CAACN,MAAM,CAAC;YACjCC,MAAM;gBACJO,QAAQf,KAAKgB,EAAE;gBACfN;gBACAC;YACF;QACF;IACF;IAEA,MAAMO,eAAeC,MAAc,EAAER,QAAgB,EAAE;QACrD,IAAIA,YAAY,GAAG;YACjB,OAAO,IAAI,CAACV,MAAM,CAACY,QAAQ,CAACO,MAAM,CAAC;gBAAEjB,OAAO;oBAAEa,IAAIG;gBAAO;YAAE;QAC7D;QACA,OAAO,IAAI,CAAClB,MAAM,CAACY,QAAQ,CAACI,MAAM,CAAC;YACjCd,OAAO;gBAAEa,IAAIG;YAAO;YACpBX,MAAM;gBAAEG;YAAS;QACnB;IACF;IAEA,MAAMU,WAAWF,MAAc,EAAE;QAC/B,OAAO,IAAI,CAAClB,MAAM,CAACY,QAAQ,CAACO,MAAM,CAAC;YAAEjB,OAAO;gBAAEa,IAAIG;YAAO;QAAE;IAC7D;IAEA,MAAMG,UAAUvB,MAAc,EAAE;QAC9B,MAAMC,OAAO,MAAM,IAAI,CAACF,OAAO,CAACC;QAChC,OAAO,IAAI,CAACE,MAAM,CAACY,QAAQ,CAACU,UAAU,CAAC;YACrCpB,OAAO;gBAAEY,QAAQf,KAAKgB,EAAE;YAAC;QAC3B;IACF;IApEA,YAAY,AAAQf,MAAqB,CAAE;aAAvBA,SAAAA;IAAwB;AAqE9C"}