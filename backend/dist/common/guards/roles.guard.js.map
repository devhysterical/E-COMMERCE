{"version":3,"sources":["../../../src/common/guards/roles.guard.ts"],"sourcesContent":["import { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';\r\nimport { Reflector } from '@nestjs/core';\r\nimport { ROLES_KEY } from '../decorators/roles.decorator';\r\n\r\ninterface JwtPayload {\r\n  sub: string;\r\n  email: string;\r\n  role: string;\r\n}\r\n\r\ninterface RequestWithUser {\r\n  user: JwtPayload;\r\n}\r\n\r\n@Injectable()\r\nexport class RolesGuard implements CanActivate {\r\n  constructor(private reflector: Reflector) {}\r\n\r\n  canActivate(context: ExecutionContext): boolean {\r\n    const requiredRoles = this.reflector.getAllAndOverride<string[]>(\r\n      ROLES_KEY,\r\n      [context.getHandler(), context.getClass()],\r\n    );\r\n    if (!requiredRoles) {\r\n      return true;\r\n    }\r\n    const request = context.switchToHttp().getRequest<RequestWithUser>();\r\n    const { user } = request;\r\n    return requiredRoles.includes(user.role);\r\n  }\r\n}\r\n"],"names":["RolesGuard","canActivate","context","requiredRoles","reflector","getAllAndOverride","ROLES_KEY","getHandler","getClass","request","switchToHttp","getRequest","user","includes","role"],"mappings":";;;;+BAeaA;;;eAAAA;;;wBAf6C;sBAChC;gCACA;;;;;;;;;;AAanB,IAAA,AAAMA,aAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,gBAAgB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CACpDC,yBAAS,EACT;YAACJ,QAAQK,UAAU;YAAIL,QAAQM,QAAQ;SAAG;QAE5C,IAAI,CAACL,eAAe;YAClB,OAAO;QACT;QACA,MAAMM,UAAUP,QAAQQ,YAAY,GAAGC,UAAU;QACjD,MAAM,EAAEC,IAAI,EAAE,GAAGH;QACjB,OAAON,cAAcU,QAAQ,CAACD,KAAKE,IAAI;IACzC;IAbA,YAAY,AAAQV,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAc7C"}