{"version":3,"sources":["../../src/orders/orders.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Param,\r\n  UseGuards,\r\n  Patch,\r\n  Res,\r\n} from '@nestjs/common';\r\nimport type { Response } from 'express';\r\nimport { OrdersService } from './orders.service';\r\nimport { InvoiceService } from './invoice.service';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\nimport { GetUser } from '../common/decorators/get-user.decorator';\r\nimport { OrderStatus, PaymentMethod } from '@prisma/client';\r\n\r\n@Controller('orders')\r\n@UseGuards(JwtAuthGuard)\r\nexport class OrdersController {\r\n  constructor(\r\n    private readonly ordersService: OrdersService,\r\n    private readonly invoiceService: InvoiceService,\r\n  ) {}\r\n\r\n  @Post()\r\n  createOrder(\r\n    @GetUser('userId') userId: string,\r\n    @Body()\r\n    dto: {\r\n      address: string;\r\n      phone: string;\r\n      paymentMethod?: PaymentMethod;\r\n      couponId?: string;\r\n      province?: string;\r\n    },\r\n  ) {\r\n    return this.ordersService.createOrder(\r\n      userId,\r\n      dto.address,\r\n      dto.phone,\r\n      dto.paymentMethod || 'COD',\r\n      dto.couponId,\r\n      dto.province,\r\n    );\r\n  }\r\n\r\n  @Get()\r\n  findAll(@GetUser('userId') userId: string) {\r\n    return this.ordersService.findAll(userId);\r\n  }\r\n\r\n  @Get(':id')\r\n  findOne(@Param('id') id: string, @GetUser('userId') userId: string) {\r\n    return this.ordersService.findOne(id, userId);\r\n  }\r\n\r\n  @Get(':id/invoice')\r\n  async downloadInvoice(\r\n    @Param('id') id: string,\r\n    @GetUser('userId') userId: string,\r\n    @Res() res: Response,\r\n  ) {\r\n    return this.invoiceService.generateInvoice(id, userId, res);\r\n  }\r\n\r\n  // Admin APIs\r\n  @Get('admin/all')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  findAllAdmin() {\r\n    return this.ordersService.findAllAdmin();\r\n  }\r\n\r\n  @Get('admin/stats')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  getStats() {\r\n    return this.ordersService.getStats();\r\n  }\r\n\r\n  @Patch('admin/:id/status')\r\n  @UseGuards(RolesGuard)\r\n  @Roles('ADMIN')\r\n  updateStatus(@Param('id') id: string, @Body() dto: { status: OrderStatus }) {\r\n    return this.ordersService.updateStatus(id, dto.status);\r\n  }\r\n}\r\n"],"names":["OrdersController","createOrder","userId","dto","ordersService","address","phone","paymentMethod","couponId","province","findAll","findOne","id","downloadInvoice","res","invoiceService","generateInvoice","findAllAdmin","getStats","updateStatus","status"],"mappings":";;;;+BAqBaA;;;eAAAA;;;wBAZN;+BAEuB;gCACC;8BACF;4BACF;gCACL;kCACE;;;;;;;;;;;;;;;AAKjB,IAAA,AAAMA,mBAAN,MAAMA;IAOXC,YACE,AAAmBC,MAAc,EACjC,AACAC,GAMC,EACD;QACA,OAAO,IAAI,CAACC,aAAa,CAACH,WAAW,CACnCC,QACAC,IAAIE,OAAO,EACXF,IAAIG,KAAK,EACTH,IAAII,aAAa,IAAI,OACrBJ,IAAIK,QAAQ,EACZL,IAAIM,QAAQ;IAEhB;IAGAC,QAAQ,AAAmBR,MAAc,EAAE;QACzC,OAAO,IAAI,CAACE,aAAa,CAACM,OAAO,CAACR;IACpC;IAGAS,QAAQ,AAAaC,EAAU,EAAE,AAAmBV,MAAc,EAAE;QAClE,OAAO,IAAI,CAACE,aAAa,CAACO,OAAO,CAACC,IAAIV;IACxC;IAEA,MACMW,gBACJ,AAAaD,EAAU,EACvB,AAAmBV,MAAc,EACjC,AAAOY,GAAa,EACpB;QACA,OAAO,IAAI,CAACC,cAAc,CAACC,eAAe,CAACJ,IAAIV,QAAQY;IACzD;IAEA,aAAa;IAIbG,eAAe;QACb,OAAO,IAAI,CAACb,aAAa,CAACa,YAAY;IACxC;IAKAC,WAAW;QACT,OAAO,IAAI,CAACd,aAAa,CAACc,QAAQ;IACpC;IAKAC,aAAa,AAAaP,EAAU,EAAE,AAAQT,GAA4B,EAAE;QAC1E,OAAO,IAAI,CAACC,aAAa,CAACe,YAAY,CAACP,IAAIT,IAAIiB,MAAM;IACvD;IAlEA,YACE,AAAiBhB,aAA4B,EAC7C,AAAiBW,cAA8B,CAC/C;aAFiBX,gBAAAA;aACAW,iBAAAA;IAChB;AAgEL"}