{"version":3,"sources":["../../src/reports/reports.controller.ts"],"sourcesContent":["import { Controller, Get, Query, UseGuards, Res } from '@nestjs/common';\r\nimport { ReportsService } from './reports.service';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\nimport { Role } from '@prisma/client';\r\nimport type { Response } from 'express';\r\n\r\n@Controller('reports')\r\n@UseGuards(JwtAuthGuard, RolesGuard)\r\n@Roles(Role.ADMIN)\r\nexport class ReportsController {\r\n  constructor(private reportsService: ReportsService) {}\r\n\r\n  @Get('export/orders')\r\n  async exportOrders(\r\n    @Query('startDate') startDate?: string,\r\n    @Query('endDate') endDate?: string,\r\n    @Res({ passthrough: true }) res?: Response,\r\n  ) {\r\n    const start = startDate ? new Date(startDate) : undefined;\r\n    const end = endDate ? new Date(endDate) : undefined;\r\n\r\n    const file = await this.reportsService.exportOrders(start, end);\r\n\r\n    res?.set({\r\n      'Content-Type':\r\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n      'Content-Disposition': `attachment; filename=\"orders_${Date.now()}.xlsx\"`,\r\n    });\r\n\r\n    return file;\r\n  }\r\n\r\n  @Get('export/products')\r\n  async exportProducts(@Res({ passthrough: true }) res?: Response) {\r\n    const file = await this.reportsService.exportProducts();\r\n\r\n    res?.set({\r\n      'Content-Type':\r\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n      'Content-Disposition': `attachment; filename=\"products_inventory_${Date.now()}.xlsx\"`,\r\n    });\r\n\r\n    return file;\r\n  }\r\n}\r\n"],"names":["ReportsController","exportOrders","startDate","endDate","res","start","Date","undefined","end","file","reportsService","set","now","exportProducts","passthrough","ADMIN"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAX0C;gCACxB;8BACF;4BACF;gCACL;wBACD;;;;;;;;;;;;;;;AAMd,IAAA,AAAMA,oBAAN,MAAMA;IAGX,MACMC,aACJ,AAAoBC,SAAkB,EACtC,AAAkBC,OAAgB,EAClC,AAA4BC,GAAc,EAC1C;QACA,MAAMC,QAAQH,YAAY,IAAII,KAAKJ,aAAaK;QAChD,MAAMC,MAAML,UAAU,IAAIG,KAAKH,WAAWI;QAE1C,MAAME,OAAO,MAAM,IAAI,CAACC,cAAc,CAACT,YAAY,CAACI,OAAOG;QAE3DJ,KAAKO,IAAI;YACP,gBACE;YACF,uBAAuB,CAAC,6BAA6B,EAAEL,KAAKM,GAAG,GAAG,MAAM,CAAC;QAC3E;QAEA,OAAOH;IACT;IAEA,MACMI,eAAe,AAA4BT,GAAc,EAAE;QAC/D,MAAMK,OAAO,MAAM,IAAI,CAACC,cAAc,CAACG,cAAc;QAErDT,KAAKO,IAAI;YACP,gBACE;YACF,uBAAuB,CAAC,yCAAyC,EAAEL,KAAKM,GAAG,GAAG,MAAM,CAAC;QACvF;QAEA,OAAOH;IACT;IAjCA,YAAY,AAAQC,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AAkCvD;;;;;;QA5BWI,aAAa;;;;;;;;;;;;;QAiBMA,aAAa;;;;;;;;;;;4CAzB/BC"}