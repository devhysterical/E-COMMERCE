{"version":3,"sources":["../../src/reports/reports.controller.ts"],"sourcesContent":["import { Controller, Get, Query, UseGuards, Res } from '@nestjs/common';\r\nimport { ReportsService } from './reports.service';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\nimport { Role } from '@prisma/client';\r\nimport type { Response } from 'express';\r\n\r\n@Controller('reports')\r\n@UseGuards(JwtAuthGuard, RolesGuard)\r\n@Roles(Role.ADMIN)\r\nexport class ReportsController {\r\n  constructor(private reportsService: ReportsService) {}\r\n\r\n  @Get('export/orders')\r\n  async exportOrders(\r\n    @Query('startDate') startDate?: string,\r\n    @Query('endDate') endDate?: string,\r\n    @Res({ passthrough: true }) res?: Response,\r\n  ) {\r\n    const start = startDate ? new Date(startDate) : undefined;\r\n    const end = endDate ? new Date(endDate) : undefined;\r\n\r\n    const file = await this.reportsService.exportOrders(start, end);\r\n\r\n    res?.set({\r\n      'Content-Type':\r\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n      'Content-Disposition': `attachment; filename=\"orders_${Date.now()}.xlsx\"`,\r\n    });\r\n\r\n    return file;\r\n  }\r\n\r\n  @Get('export/products')\r\n  async exportProducts(@Res({ passthrough: true }) res?: Response) {\r\n    const file = await this.reportsService.exportProducts();\r\n\r\n    res?.set({\r\n      'Content-Type':\r\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n      'Content-Disposition': `attachment; filename=\"products_inventory_${Date.now()}.xlsx\"`,\r\n    });\r\n\r\n    return file;\r\n  }\r\n\r\n  // ===== ANALYTICS v2 =====\r\n\r\n  @Get('analytics/revenue')\r\n  getRevenueChart(@Query('period') period?: string) {\r\n    return this.reportsService.getRevenueChart(period || '30d');\r\n  }\r\n\r\n  @Get('analytics/orders')\r\n  getOrderChart(@Query('period') period?: string) {\r\n    return this.reportsService.getOrderChart(period || '30d');\r\n  }\r\n\r\n  @Get('analytics/top-products')\r\n  getTopProducts(@Query('limit') limit?: string) {\r\n    return this.reportsService.getTopProducts(limit ? parseInt(limit, 10) : 10);\r\n  }\r\n\r\n  @Get('analytics/top-customers')\r\n  getTopCustomers(@Query('limit') limit?: string) {\r\n    return this.reportsService.getTopCustomers(\r\n      limit ? parseInt(limit, 10) : 10,\r\n    );\r\n  }\r\n\r\n  @Get('analytics/categories')\r\n  getCategoryBreakdown() {\r\n    return this.reportsService.getCategoryBreakdown();\r\n  }\r\n\r\n  @Get('analytics/conversion')\r\n  getConversionStats() {\r\n    return this.reportsService.getConversionStats();\r\n  }\r\n}\r\n"],"names":["ReportsController","exportOrders","startDate","endDate","res","start","Date","undefined","end","file","reportsService","set","now","exportProducts","getRevenueChart","period","getOrderChart","getTopProducts","limit","parseInt","getTopCustomers","getCategoryBreakdown","getConversionStats","passthrough","ADMIN"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAX0C;gCACxB;8BACF;4BACF;gCACL;wBACD;;;;;;;;;;;;;;;AAMd,IAAA,AAAMA,oBAAN,MAAMA;IAGX,MACMC,aACJ,AAAoBC,SAAkB,EACtC,AAAkBC,OAAgB,EAClC,AAA4BC,GAAc,EAC1C;QACA,MAAMC,QAAQH,YAAY,IAAII,KAAKJ,aAAaK;QAChD,MAAMC,MAAML,UAAU,IAAIG,KAAKH,WAAWI;QAE1C,MAAME,OAAO,MAAM,IAAI,CAACC,cAAc,CAACT,YAAY,CAACI,OAAOG;QAE3DJ,KAAKO,IAAI;YACP,gBACE;YACF,uBAAuB,CAAC,6BAA6B,EAAEL,KAAKM,GAAG,GAAG,MAAM,CAAC;QAC3E;QAEA,OAAOH;IACT;IAEA,MACMI,eAAe,AAA4BT,GAAc,EAAE;QAC/D,MAAMK,OAAO,MAAM,IAAI,CAACC,cAAc,CAACG,cAAc;QAErDT,KAAKO,IAAI;YACP,gBACE;YACF,uBAAuB,CAAC,yCAAyC,EAAEL,KAAKM,GAAG,GAAG,MAAM,CAAC;QACvF;QAEA,OAAOH;IACT;IAEA,2BAA2B;IAG3BK,gBAAgB,AAAiBC,MAAe,EAAE;QAChD,OAAO,IAAI,CAACL,cAAc,CAACI,eAAe,CAACC,UAAU;IACvD;IAGAC,cAAc,AAAiBD,MAAe,EAAE;QAC9C,OAAO,IAAI,CAACL,cAAc,CAACM,aAAa,CAACD,UAAU;IACrD;IAGAE,eAAe,AAAgBC,KAAc,EAAE;QAC7C,OAAO,IAAI,CAACR,cAAc,CAACO,cAAc,CAACC,QAAQC,SAASD,OAAO,MAAM;IAC1E;IAGAE,gBAAgB,AAAgBF,KAAc,EAAE;QAC9C,OAAO,IAAI,CAACR,cAAc,CAACU,eAAe,CACxCF,QAAQC,SAASD,OAAO,MAAM;IAElC;IAGAG,uBAAuB;QACrB,OAAO,IAAI,CAACX,cAAc,CAACW,oBAAoB;IACjD;IAGAC,qBAAqB;QACnB,OAAO,IAAI,CAACZ,cAAc,CAACY,kBAAkB;IAC/C;IAnEA,YAAY,AAAQZ,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AAoEvD;;;;;;QA9DWa,aAAa;;;;;;;;;;;;;QAiBMA,aAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4CAzB/BC"}