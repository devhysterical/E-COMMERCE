{"version":3,"sources":["../../src/coupons/coupons.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Patch,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  UseGuards,\r\n  Request,\r\n} from '@nestjs/common';\r\nimport { CouponsService } from './coupons.service';\r\nimport {\r\n  CreateCouponDto,\r\n  UpdateCouponDto,\r\n  ValidateCouponDto,\r\n} from './dto/coupon.dto';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\nimport { Role } from '@prisma/client';\r\n\r\n@Controller('coupons')\r\n@UseGuards(JwtAuthGuard)\r\nexport class CouponsController {\r\n  constructor(private couponsService: CouponsService) {}\r\n\r\n  // ===== User Endpoints =====\r\n\r\n  // GET /coupons/available - Lấy danh sách mã giảm giá khả dụng\r\n  @Get('available')\r\n  getAvailableCoupons() {\r\n    return this.couponsService.getAvailableCoupons();\r\n  }\r\n\r\n  // POST /coupons/validate - Validate coupon code\r\n  @Post('validate')\r\n  validateCoupon(\r\n    @Body() dto: ValidateCouponDto,\r\n    @Request() req: { user: { userId: string } },\r\n  ) {\r\n    return this.couponsService.validateCoupon(dto, req.user.userId);\r\n  }\r\n\r\n  // ===== Admin Endpoints =====\r\n\r\n  // GET /coupons/admin - Lấy tất cả coupons\r\n  @Get('admin')\r\n  @UseGuards(RolesGuard)\r\n  @Roles(Role.ADMIN)\r\n  findAll() {\r\n    return this.couponsService.findAll();\r\n  }\r\n\r\n  // GET /coupons/admin/:id - Lấy chi tiết coupon\r\n  @Get('admin/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles(Role.ADMIN)\r\n  findOne(@Param('id') id: string) {\r\n    return this.couponsService.findOne(id);\r\n  }\r\n\r\n  // POST /coupons/admin - Tạo coupon mới\r\n  @Post('admin')\r\n  @UseGuards(RolesGuard)\r\n  @Roles(Role.ADMIN)\r\n  create(@Body() dto: CreateCouponDto) {\r\n    return this.couponsService.create(dto);\r\n  }\r\n\r\n  // PATCH /coupons/admin/:id - Cập nhật coupon\r\n  @Patch('admin/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles(Role.ADMIN)\r\n  update(@Param('id') id: string, @Body() dto: UpdateCouponDto) {\r\n    return this.couponsService.update(id, dto);\r\n  }\r\n\r\n  // DELETE /coupons/admin/:id - Xóa coupon\r\n  @Delete('admin/:id')\r\n  @UseGuards(RolesGuard)\r\n  @Roles(Role.ADMIN)\r\n  remove(@Param('id') id: string) {\r\n    return this.couponsService.remove(id);\r\n  }\r\n}\r\n"],"names":["CouponsController","getAvailableCoupons","couponsService","validateCoupon","dto","req","user","userId","findAll","findOne","id","create","update","remove","ADMIN"],"mappings":";;;;+BAwBaA;;;eAAAA;;;wBAdN;gCACwB;2BAKxB;8BACsB;4BACF;gCACL;wBACD;;;;;;;;;;;;;;;AAId,IAAA,AAAMA,oBAAN,MAAMA;IAGX,6BAA6B;IAE7B,8DAA8D;IAE9DC,sBAAsB;QACpB,OAAO,IAAI,CAACC,cAAc,CAACD,mBAAmB;IAChD;IAEA,gDAAgD;IAEhDE,eACE,AAAQC,GAAsB,EAC9B,AAAWC,GAAiC,EAC5C;QACA,OAAO,IAAI,CAACH,cAAc,CAACC,cAAc,CAACC,KAAKC,IAAIC,IAAI,CAACC,MAAM;IAChE;IAEA,8BAA8B;IAE9B,0CAA0C;IAI1CC,UAAU;QACR,OAAO,IAAI,CAACN,cAAc,CAACM,OAAO;IACpC;IAEA,+CAA+C;IAI/CC,QAAQ,AAAaC,EAAU,EAAE;QAC/B,OAAO,IAAI,CAACR,cAAc,CAACO,OAAO,CAACC;IACrC;IAEA,uCAAuC;IAIvCC,OAAO,AAAQP,GAAoB,EAAE;QACnC,OAAO,IAAI,CAACF,cAAc,CAACS,MAAM,CAACP;IACpC;IAEA,6CAA6C;IAI7CQ,OAAO,AAAaF,EAAU,EAAE,AAAQN,GAAoB,EAAE;QAC5D,OAAO,IAAI,CAACF,cAAc,CAACU,MAAM,CAACF,IAAIN;IACxC;IAEA,yCAAyC;IAIzCS,OAAO,AAAaH,EAAU,EAAE;QAC9B,OAAO,IAAI,CAACR,cAAc,CAACW,MAAM,CAACH;IACpC;IA3DA,YAAY,AAAQR,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AA4DvD;;;;;;;;;;;;;;;;;;;;;4CApCcY;;;;;;;;4CAQAA;;;;;;;;;;;4CAQAA;;;;;;;;;;;4CAQAA;;;;;;;;;;;;;4CAQAA"}