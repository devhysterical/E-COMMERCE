{"version":3,"sources":["../../src/products/products.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Patch,\r\n  Param,\r\n  Delete,\r\n  Query,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport { ProductsService } from './products.service';\r\nimport { CreateProductDto, UpdateProductDto } from './dto/product.dto';\r\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../common/guards/roles.guard';\r\nimport { Roles } from '../common/decorators/roles.decorator';\r\nimport { Role } from '@prisma/client';\r\n\r\n@Controller('products')\r\n@UseGuards(JwtAuthGuard, RolesGuard)\r\nexport class ProductsController {\r\n  constructor(private readonly productsService: ProductsService) {}\r\n\r\n  @Post()\r\n  @Roles(Role.ADMIN)\r\n  create(@Body() createProductDto: CreateProductDto) {\r\n    return this.productsService.create(createProductDto);\r\n  }\r\n\r\n  @Get()\r\n  findAll(\r\n    @Query('categoryId') categoryId?: string,\r\n    @Query('search') search?: string,\r\n    @Query('page') page?: string,\r\n    @Query('limit') limit?: string,\r\n    @Query('sortBy') sortBy?: 'price' | 'name' | 'createdAt',\r\n    @Query('sortOrder') sortOrder?: 'asc' | 'desc',\r\n    @Query('minPrice') minPrice?: string,\r\n    @Query('maxPrice') maxPrice?: string,\r\n  ) {\r\n    return this.productsService.findAll(\r\n      categoryId,\r\n      search,\r\n      page ? parseInt(page, 10) : 1,\r\n      limit ? parseInt(limit, 10) : 12,\r\n      sortBy || 'createdAt',\r\n      sortOrder || 'desc',\r\n      minPrice ? parseInt(minPrice, 10) : undefined,\r\n      maxPrice ? parseInt(maxPrice, 10) : undefined,\r\n    );\r\n  }\r\n\r\n  // Search Autocomplete - gợi ý khi gõ tìm kiếm\r\n  @Get('search/suggest')\r\n  searchSuggest(@Query('q') query?: string, @Query('limit') limit?: string) {\r\n    return this.productsService.searchSuggest(\r\n      query || '',\r\n      limit ? parseInt(limit, 10) : 5,\r\n    );\r\n  }\r\n\r\n  // Related Products - sản phẩm cùng category\r\n  @Get('related/:id')\r\n  getRelated(@Param('id') id: string, @Query('limit') limit?: string) {\r\n    return this.productsService.getRelatedProducts(\r\n      id,\r\n      limit ? parseInt(limit, 10) : 4,\r\n    );\r\n  }\r\n\r\n  // Low Stock Products - sản phẩm tồn kho thấp (Admin)\r\n  @Get('low-stock')\r\n  getLowStock(@Query('threshold') threshold?: string) {\r\n    return this.productsService.getLowStockProducts(\r\n      threshold ? parseInt(threshold, 10) : 10,\r\n    );\r\n  }\r\n\r\n  @Get(':id')\r\n  findOne(@Param('id') id: string) {\r\n    return this.productsService.findOne(id);\r\n  }\r\n\r\n  @Patch(':id')\r\n  @Roles(Role.ADMIN)\r\n  update(@Param('id') id: string, @Body() updateProductDto: UpdateProductDto) {\r\n    return this.productsService.update(id, updateProductDto);\r\n  }\r\n\r\n  @Delete(':id')\r\n  @Roles(Role.ADMIN)\r\n  remove(@Param('id') id: string) {\r\n    return this.productsService.remove(id);\r\n  }\r\n\r\n  // ===== Product Images Endpoints =====\r\n\r\n  @Get(':id/images')\r\n  getImages(@Param('id') id: string) {\r\n    return this.productsService.getImages(id);\r\n  }\r\n\r\n  @Post(':id/images')\r\n  @Roles(Role.ADMIN)\r\n  addImage(\r\n    @Param('id') id: string,\r\n    @Body() body: { imageUrl: string; isPrimary?: boolean },\r\n  ) {\r\n    return this.productsService.addImage(id, body.imageUrl, body.isPrimary);\r\n  }\r\n\r\n  @Delete(':id/images/:imageId')\r\n  @Roles(Role.ADMIN)\r\n  removeImage(@Param('id') id: string, @Param('imageId') imageId: string) {\r\n    return this.productsService.removeImage(id, imageId);\r\n  }\r\n\r\n  @Patch(':id/images/:imageId/primary')\r\n  @Roles(Role.ADMIN)\r\n  setPrimaryImage(@Param('id') id: string, @Param('imageId') imageId: string) {\r\n    return this.productsService.setPrimaryImage(id, imageId);\r\n  }\r\n}\r\n"],"names":["ProductsController","create","createProductDto","productsService","findAll","categoryId","search","page","limit","sortBy","sortOrder","minPrice","maxPrice","parseInt","undefined","searchSuggest","query","getRelated","id","getRelatedProducts","getLowStock","threshold","getLowStockProducts","findOne","update","updateProductDto","remove","getImages","addImage","body","imageUrl","isPrimary","removeImage","imageId","setPrimaryImage","ADMIN"],"mappings":";;;;+BAoBaA;;;eAAAA;;;wBAVN;iCACyB;4BACmB;8BACtB;4BACF;gCACL;wBACD;;;;;;;;;;;;;;;AAId,IAAA,AAAMA,qBAAN,MAAMA;IAKXC,OAAO,AAAQC,gBAAkC,EAAE;QACjD,OAAO,IAAI,CAACC,eAAe,CAACF,MAAM,CAACC;IACrC;IAGAE,QACE,AAAqBC,UAAmB,EACxC,AAAiBC,MAAe,EAChC,AAAeC,IAAa,EAC5B,AAAgBC,KAAc,EAC9B,AAAiBC,MAAuC,EACxD,AAAoBC,SAA0B,EAC9C,AAAmBC,QAAiB,EACpC,AAAmBC,QAAiB,EACpC;QACA,OAAO,IAAI,CAACT,eAAe,CAACC,OAAO,CACjCC,YACAC,QACAC,OAAOM,SAASN,MAAM,MAAM,GAC5BC,QAAQK,SAASL,OAAO,MAAM,IAC9BC,UAAU,aACVC,aAAa,QACbC,WAAWE,SAASF,UAAU,MAAMG,WACpCF,WAAWC,SAASD,UAAU,MAAME;IAExC;IAEA,8CAA8C;IAE9CC,cAAc,AAAYC,KAAc,EAAE,AAAgBR,KAAc,EAAE;QACxE,OAAO,IAAI,CAACL,eAAe,CAACY,aAAa,CACvCC,SAAS,IACTR,QAAQK,SAASL,OAAO,MAAM;IAElC;IAEA,4CAA4C;IAE5CS,WAAW,AAAaC,EAAU,EAAE,AAAgBV,KAAc,EAAE;QAClE,OAAO,IAAI,CAACL,eAAe,CAACgB,kBAAkB,CAC5CD,IACAV,QAAQK,SAASL,OAAO,MAAM;IAElC;IAEA,qDAAqD;IAErDY,YAAY,AAAoBC,SAAkB,EAAE;QAClD,OAAO,IAAI,CAAClB,eAAe,CAACmB,mBAAmB,CAC7CD,YAAYR,SAASQ,WAAW,MAAM;IAE1C;IAGAE,QAAQ,AAAaL,EAAU,EAAE;QAC/B,OAAO,IAAI,CAACf,eAAe,CAACoB,OAAO,CAACL;IACtC;IAIAM,OAAO,AAAaN,EAAU,EAAE,AAAQO,gBAAkC,EAAE;QAC1E,OAAO,IAAI,CAACtB,eAAe,CAACqB,MAAM,CAACN,IAAIO;IACzC;IAIAC,OAAO,AAAaR,EAAU,EAAE;QAC9B,OAAO,IAAI,CAACf,eAAe,CAACuB,MAAM,CAACR;IACrC;IAEA,uCAAuC;IAGvCS,UAAU,AAAaT,EAAU,EAAE;QACjC,OAAO,IAAI,CAACf,eAAe,CAACwB,SAAS,CAACT;IACxC;IAIAU,SACE,AAAaV,EAAU,EACvB,AAAQW,IAA+C,EACvD;QACA,OAAO,IAAI,CAAC1B,eAAe,CAACyB,QAAQ,CAACV,IAAIW,KAAKC,QAAQ,EAAED,KAAKE,SAAS;IACxE;IAIAC,YAAY,AAAad,EAAU,EAAE,AAAkBe,OAAe,EAAE;QACtE,OAAO,IAAI,CAAC9B,eAAe,CAAC6B,WAAW,CAACd,IAAIe;IAC9C;IAIAC,gBAAgB,AAAahB,EAAU,EAAE,AAAkBe,OAAe,EAAE;QAC1E,OAAO,IAAI,CAAC9B,eAAe,CAAC+B,eAAe,CAAChB,IAAIe;IAClD;IApGA,YAAY,AAAiB9B,eAAgC,CAAE;aAAlCA,kBAAAA;IAAmC;AAqGlE;;;4CAlGcgC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;4CA4DAA;;;;;;;;;;;;4CAMAA;;;;;;;;;;;;;;;;;;;4CAaAA;;;;;;;;;;;;4CASAA;;;;;;;;;;;;4CAMAA"}